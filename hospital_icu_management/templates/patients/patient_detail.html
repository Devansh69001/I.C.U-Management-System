{% extends 'base.html' %}
{% block title %}{{ patient.first_name }} {{ patient.last_name }} - Patient Details{% endblock %}

{% block content %}
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <h2><i class="bi bi-person-circle"></i> Patient Details</h2>
        <div>
            <a href="{% url 'patient_update' patient.id %}" class="btn btn-warning">
                <i class="bi bi-pencil"></i> Edit
            </a>
            <a href="{% url 'patient_list' %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to List
            </a>
        </div>
    </div>
</div>

<div class="row">
    <!-- Patient Info Card -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>Personal Information</h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <i class="bi bi-person-circle" style="font-size: 5rem; color: var(--primary-color);"></i>
                    <h4 class="mt-2">{{ patient.first_name }} {{ patient.last_name }}</h4>
                    <span class="badge bg-primary">ID: #{{ patient.id }}</span>
                </div>
                
                <hr>
                
                <div class="mb-2">
                    <strong><i class="bi bi-calendar"></i> Age:</strong> {{ patient.age }} years
                </div>
                <div class="mb-2">
                    <strong><i class="bi bi-gender-ambiguous"></i> Gender:</strong> {{ patient.get_gender_display }}
                </div>
                <div class="mb-2">
                    <strong><i class="bi bi-droplet"></i> Blood Type:</strong> 
                    <span class="badge bg-danger">{{ patient.blood_type }}</span>
                </div>
                <div class="mb-2">
                    <strong><i class="bi bi-telephone"></i> Phone:</strong> {{ patient.phone_number }}
                </div>
                <div class="mb-2">
                    <strong><i class="bi bi-envelope"></i> Email:</strong> {{ patient.email|default:"-" }}
                </div>
                <div class="mb-2">
                    <strong><i class="bi bi-geo-alt"></i> Address:</strong><br>
                    {{ patient.address }}
                </div>
            </div>
        </div>
        
        <!-- Emergency Contact -->
        <div class="card mt-3">
            <div class="card-header">
                <h5>Emergency Contact</h5>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <strong>Name:</strong> {{ patient.emergency_contact_name }}
                </div>
                <div class="mb-2">
                    <strong>Relationship:</strong> {{ patient.emergency_contact_relationship }}
                </div>
                <div class="mb-2">
                    <strong>Phone:</strong> {{ patient.emergency_contact_phone }}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Medical Information -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5>Medical Information</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Status:</strong>
                        {% if patient.status == 'critical' %}
                            <span class="badge bg-danger">Critical</span>
                        {% elif patient.status == 'admitted' %}
                            <span class="badge bg-warning">Admitted</span>
                        {% else %}
                            <span class="badge bg-success">{{ patient.get_status_display }}</span>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <strong>Room Number:</strong> {{ patient.room_number|default:"-" }}
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Admission Date:</strong> {{ patient.admission_date|date:"M d, Y H:i" }}
                    </div>
                    <div class="col-md-6">
                        <strong>Discharge Date:</strong> {{ patient.discharge_date|date:"M d, Y"|default:"-" }}
                    </div>
                </div>
                
                <hr>
                
                <h6>Medical History</h6>
                <p>{{ patient.medical_history|default:"No medical history recorded"|linebreaks }}</p>
                
                <h6>Allergies</h6>
                <p>{{ patient.allergies|default:"No known allergies"|linebreaks }}</p>
                
                <h6>Current Medications</h6>
                <p>{{ patient.current_medications|default:"No current medications"|linebreaks }}</p>
            </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="card mt-3">
            <div class="card-header">
                <h5>Recent Activity</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {% for admission in patient.admission_set.all|slice:":5" %}
                    <li class="list-group-item">
                        <strong>Admission:</strong> {{ admission.admission_date_time|date:"M d, Y H:i" }}
                        <br><small class="text-muted">by {{ admission.nurse.user.get_full_name }}</small>
                    </li>
                    {% endfor %}
                    
                    {% for prescription in patient.prescription_set.all|slice:":5" %}
                    <li class="list-group-item">
                        <strong>Prescription:</strong> {{ prescription.medicine }}
                        <br><small class="text-muted">by Dr. {{ prescription.doctor.user.get_full_name }} on {{ prescription.created_at|date:"M d, Y" }}</small>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
